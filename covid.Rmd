---
title: "Covid"
author: "Sanjay Nanjundappa"
date: "2024-03-28"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse) # metapackage with lots of helpful functions
library(dplyr)
library(plotly)
library(ggplot2)
library(IRdisplay)
library(leaflet)
library(leafpop)
library(dplyr)
library(purrr)


confirmed_color <- "purple"
active_color <- "#1f77b4"
confirmed_color <- "forestgreen"
death_color <- "red"

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}

#change path
base_folder <- "D:/Trent University/R ONLINE LECTURERS/Assignments/Covid_data_analysis/"
inputfolder <- paste0(base_folder,"inputfiles/")

coronavirus <- read.csv(paste0(inputfolder,"coronavirus_dataset.csv"))
coronavirus  <- coronavirus %>% rename(dateVals=date)
coronavirus$dateVals = as.Date(coronavirus$dateVals)
```

Data transformations

```{r}
covid_data <- coronavirus %>% 
  dplyr::group_by(Country.Region, type) %>%
  dplyr::summarise(total = sum(cases), .groups = "drop") %>%
  tidyr::pivot_wider(names_from = type, 
                     values_from = total) %>%
  dplyr::mutate(unrecovered = confirmed - ifelse(is.na(recovered), 0, recovered) - ifelse(is.na(death), 0, death)) %>%
  dplyr::arrange(-confirmed) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(country = dplyr::if_else(Country.Region == "United Arab Emirates", "UAE", as.character(Country.Region))) %>%
  dplyr::mutate(country = dplyr::if_else(country == "Mainland China", "China", as.character(country))) %>%
  dplyr::mutate(country = dplyr::if_else(country == "North Macedonia", "N.Macedonia", as.character(country))) %>%
  dplyr::mutate(country = trimws(country)) %>%
  dplyr::mutate(country = factor(country, levels = country))

covid_data = covid_data[,c("Country.Region","confirmed",'death',"recovered","unrecovered")]
head(covid_data)

```

### **Null Hypothesis (H0)**

- There is no correlation between confirmed cases and deaths.

### **Alternative Hypothesis (H1)**

- There is a correlation between confirmed cases and deaths.

## **Assumptions**

1.  **Outliers**: The observations has outliers or not.

2.  **Normality**: The residuals of the model are normally distributed.

3.  **Homogeneity of Variance**: The variance of the dependent variable is the same for all levels of the independent variable (Country).

```{r}
library(datarium)
library(rstatix)
covid_grouping <- group_by(covid_data,confirmed)
get_summary_stats(covid_grouping, type = "mean_sd")

```


Before conducting hypothesis we are going to check our assumptions

1.  check if there are any outliers

```{r}
library(psych)
library(rstatix)
describe(covid_data, fast = TRUE)
```

```{r}
identify_outliers(covid_data, confirmed)
```

```{r}
identify_outliers(covid_data, death)
x= identify_outliers(covid_data, death)

```

We have outliers

```{r}
# creating a subset of our dataset without that case.
covid_noOutliers <- x[!(x$is.extreme==TRUE),]
```


2.  Normality test

```{r}
#Next, we need to test for normality of each of the variables.
# Note: we can run the Shapiro-Wilks test on multiple variables at once

shapiro_test(covid_noOutliers, vars = c("confirmed", "death"))
```
p-value is above 0.05, data is normal distribution


3. Linearity
```{r}
# Plot confirmed cases against deaths with adjusted scales
plot(covid_data$confirmed, covid_data$death,
     xlim = c(0, max(covid_data$confirmed) * 1.1),  # Adjust x-axis limits
     ylim = c(0, max(covid_data$death) * 1.1),      # Adjust y-axis limits
     xlab = "Confirmed Cases",                      # Label for x-axis
     ylab = "Deaths",                               # Label for y-axis
     main = "Confirmed Cases vs Deaths")            # Main title for the plot
```

The points are scattered but very  close to each other. linearly growing as well


Correlation test

```{r}
# Perform correlation test
cor.test(covid_data$confirmed, covid_data$death, method = "pearson")
```
P-value is low, p-value is 2.2e-16 which is less than 0.05

Since p-value from correlation is less than 0.05 we reject null hypothesis and say there is relation between confirmed and death cases in covid data.


Visulaizations

```{r,split=FALSE, fig.align = 'default', warning = FALSE, out.width="100%"}
p<-plot_ly(data = df[1:30,], 
        x = ~ Country.Region, 
        y = ~ unrecovered, 
        # text =  ~ confirmed, 
        # textposition = 'auto',
        type = "bar", 
        name = "Active",
        marker = list(color = active_color)) %>%
    add_trace(y = ~ confirmed, 
        # text =  ~ recovered, 
        # textposition = 'auto',
        name = "Recovered",
        marker = list(color = confirmed_color)) %>%
    add_trace(y = ~ death, 
        # text =  ~ death, 
        # textposition = 'auto',
        name = "Death",
        marker = list(color = death_color)) %>%
    layout(barmode = 'stack',
       yaxis = list(title = "Total Cases (log scaled)", type = "log"),
       xaxis = list(title = ""),
       hovermode = "compare",
       margin =  list(
           # l = 60,
           # r = 40,
           b = 10,
           t = 10,
           pad = 2
        )
      )

ggplotly(p)
```
